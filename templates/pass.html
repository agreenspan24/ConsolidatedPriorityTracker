<script>
    function updateStatus(shift_id) {
        hideAlert();

        var statusElem = $('#status-' + shift_id);
        var status = statusElem.val();
        var name = $('#name-' + shift_id).html();

        showAlert('info', 'Updating status for ' + name);
        
        statusElem.prop('disabled', 'disabled');

        $.ajax({
            type: 'POST', 
            url: '/consolidated/{{location.locationname[0:3]}}/{{active_tab}}/pass',
            data: {
                shift_id: shift_id,
                status: status
            }
        }).done(function(){
            showAlert('success', 'Status for ' + name + ' has been updated');
            statusElem.prop('disabled', false);
        }).fail(function(){
            showAlert('error', 'Status for ' + name + ' has NOT been updated');
            statusElem.prop('disabled', false);
        });
    }

    function addNote(note_id) {
        hideAlert();

        var noteElem = $('#' + note_id);
        var note = noteElem.val();

        var shift_id = note_id.split('-').pop();
        var name = $('#name-' + shift_id).html();

        showAlert('info', 'Adding note for ' + name);
        noteElem.prop('disabled', 'disabled');

        $.ajax({
            type: 'POST', 
            url: '/consolidated/{{location.locationname[0:3]}}/{{active_tab}}/pass',
            data: {
                shift_id: shift_id,
                note: note
            }
        }).done(function(){
            showAlert('success', 'Note for ' + name + ' has been added');
            noteElem.prop('disabled', false);

            var date = new Date();
            var hour = date.getHours();
            var pm = hour > 12;

            var min = date.getMinutes();
            var minutes = min.length < 2 ? "0" + min : min;

            var child = document.createElement('td');
            child.innerText = (pm ? hour - 12 : hour) + ":" + minutes + (pm ? ' PM' : ' AM') +  ": " + note;
            $('#row-' + shift_id).append(child);
            noteElem.val('');

        }).fail(function(){
            showAlert('error', 'Note for ' + name + ' has NOT been added');
            noteElem.prop('disabled', false);
        });
    }

    $('body').on('keyup', function(e) {
        console.log('in', e, e.target.attributes['name'].nodeValue, e.target.attributes, e.keyCode);
        e.preventDefault();

        if (e.target.attributes['name'].nodeValue == 'note' && e.keyCode == 13) {
            console.log('adding')
            addNote(event.target.id);
        }
    });




</script>